# Generated by Anaconda 34.25.4.9
# Generated by pykickstart v3.32
#version=RHEL9
# Use graphical install
text

# Configuración básica
install
cdrom
lang en_US.UTF-8
keyboard la
timezone America/Mexico_City --isUtc --ntpservers=cronos.cenam.mx
rootpw --plaintext password  # Cambia esto por una contraseña segura
%addon com_redhat_kdump --disable
%end

# Configuración de red (opcional)
network --bootproto=dhcp --device=eth0 --onboot=on

# Configuración del disco
clearpart --all --initlabel
part /boot --fstype="xfs" --size=1024  # Partición de arranque de 1 GB
part pv.01 --size=1 --grow  # Partición física para LVM (ocupa el espacio restante)
volgroup ol_mini --pesize=4096 pv.01  # Grupo de volúmenes
logvol / --fstype="xfs" --size=9310 --name=root --vgname=ol_mini  # Partición raíz de 9.1 GB
logvol swap --fstype="swap" --size=2048 --name=swap --vgname=ol_mini  # Partición de intercambio

firewall --enable 
firewall --ssh

# Configuración del repositorio (usar el CD/DVD como fuente)
repo --name="CDROM" --baseurl=cdrom:sr0 --cost=100

# Selección de paquetes mínimos
%packages
@^minimal
openssl
vim
tree
%end

# Configuración posterior a la instalación
%post --log=/root/ks-post.log
echo "My IP address: \4" >> /etc/issue
# Generar un nombre de host aleatorio
HOSTNAME="host-$(openssl rand -hex 3)"
echo "Nombre de host generado: $HOSTNAME" >> /root/ks-post.log

# Configurar el nombre de host
hostnamectl set-hostname "$HOSTNAME"
echo "$HOSTNAME" > /etc/hostname

# Con la novedad de agregar llave publica
cat <<-EOF > /root/.ssh/known_hosts
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCszH9vZ0iSBs7t/r9aG+OrQt8/7qWu4q+rTAz07AeN5SUx5TU5K0uJmWHZMSzbV+HXFdFQxpcTQeVGkwHER2km0fVY699R5F0g6kZz5ocwIrVDrBJMEZSwt5nScq4oCaXnCr5sGCFXS6BaHGoP5m3M1WTKcc4ipmJ8+MNG5duIuBgtAx0DvqhJfubIgoeKlubQxCB4r9V1bryYt+MRjfcstATSDnMaFc1bdxJx/j6dcugBLwnA70WmkUZbTTTw6yk7RH3nQN3zqfJQT83AVaAMAeZjiBFx4m/FuZASw0OxH+dlGDbsXtmfCI20933qTEOGaJoM3JcLAul8Uk+dg0LugJhA/GonXMgMvKHCGw5/LnWMJmOnwMkOioorxVfAdY3K8HDdA4D3ngT34vZ2DAyIXG83EXKYJ1MPQA1tujbbTdCFkB7zEABJfyW7TcwjdC4A5mgJiBby6wjLI10ffm8vzmrayff+DZHMeTvhO01ctREaH/R6cMY1LaUeJyQn8yE= cristian@ubu
EOF
curl -o /etc/yum.repos.d/CentOS-Base.repo https://el7.repo.almalinux.org/centos/CentOS-Base.repo
%end
# Reiniciar después de la instalación
reboot
# https://phoenixnap.com/kb/migrate-centos-to-rocky-linux
# uncomment this line in file /etc/libvirt/libvirt.conf
# uri_default = "qemu:///system"
# Or
#  ~/.config/libvirt/libvirt.conf
# add
# uri_default = "qemu:///system"
# https://serverfault.com/questions/803283/how-do-i-list-virsh-networks-without-sudo

